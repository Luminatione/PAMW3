# Docs for the Azure Web Apps Deploy action: https://github.com/Azure/webapps-deploy
# More GitHub Actions for Azure: https://github.com/Azure/actions

name: Build and deploy ASP.Net Core app to Azure Web App - MWO4

on:
  pull_request:
    branches:
      - '*'
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
   
    steps:
     
      - name: Create Ticket
        run: |
          echo "Azure DevOps Token: $AZURE_DEVOPS_TOKEN"
          echo "API URL: https://dev.azure.com/01171749/MWO4/_apis/wit/workitems/\$Issue?api-version=7.1-preview.3"
          curl -g -X POST -H "Content-Type: application/json-patch+json" -H "Authorization: Basic OmZmYTc3djJ4M3NsbHFldnQyNjNlNHhxNWFyejVvYXcyYm9hdm03a2prdWx3cHFxeGhkdmE=" --data "[{ \"op\": \"add\", \"path\": \"/fields/System.Title\", \"from\": null, \"value\": \"UI test failed\" }]" "https://dev.azure.com/01171749/MWO4/_apis/wit/workitems/%24Issue?api-version=7.1-preview.3" -o response.json 
          cat response.json
        env:
          AZURE_DEVOPS_TOKEN: ${{ secrets.PAT }}
